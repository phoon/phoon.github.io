<!doctype html><html lang=zh-cn><head><script async defer data-website-id=fb39513f-8d55-4a6d-a297-e501c14680ca src=https://umami.peven.me/umami.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>红黑树那点事儿 - 瘋魔</title><meta name=Description content="Peven's web site. Find my information, my blog on technologies and personal hobbies here."><meta property="og:title" content="红黑树那点事儿"><meta property="og:description" content="前置知识：二叉查找树、B树，本文不多做介绍。 0. 写在前面 在观察和思考红黑树时，一定要牢记：红黑树是一颗平衡二叉查找树，我们所赋予红黑树的一切行"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.peven.me/post/2021/05/08/the-red-black-tree/"><meta property="og:image" content="https://blog.peven.me/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-08T16:41:57+08:00"><meta property="article:modified_time" content="2022-07-15T23:16:53+08:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.peven.me/logo.png"><meta name=twitter:title content="红黑树那点事儿"><meta name=twitter:description content="前置知识：二叉查找树、B树，本文不多做介绍。 0. 写在前面 在观察和思考红黑树时，一定要牢记：红黑树是一颗平衡二叉查找树，我们所赋予红黑树的一切行"><meta name=application-name content="瘋魔"><meta name=apple-mobile-web-app-title content="瘋魔"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.peven.me/post/2021/05/08/the-red-black-tree/><link rel=prev href=https://blog.peven.me/post/2019/08/15/anywhere2s-polling-issue-on-archlinux/><link rel=next href=https://blog.peven.me/post/2021/08/21/dgraph-memo/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://unpkg.com/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://unpkg.com/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"红黑树那点事儿","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.peven.me\/post\/2021\/05\/08\/the-red-black-tree\/"},"image":["https:\/\/blog.peven.me\/images\/screenshot.png"],"genre":"posts","keywords":"红黑树","wordcount":4441,"url":"https:\/\/blog.peven.me\/post\/2021\/05\/08\/the-red-black-tree\/","datePublished":"2021-05-08T16:41:57+08:00","dateModified":"2022-07-15T23:16:53+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Peven","logo":"https:\/\/blog.peven.me\/images\/avatar.jpg"},"author":{"@type":"Person","name":"Peven"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=瘋魔><img class="lazyload logo" src=/svg/loading.min.svg data-src=/title.png data-srcset="/title.png, /title.png 1.5x, /title.png 2x" data-sizes=auto alt=/title.png title=/title.png></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friends/>友链 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/phoon title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><a class=menu-item href=/index.xml title=RSS><i class='fas fa-rss-square'></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/post/2021/05/08/the-red-black-tree/ selected>简体中文</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=找啥呢,给点提示让咱帮帮你... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=瘋魔><img class="lazyload logo" src=/svg/loading.min.svg data-src=/title.png data-srcset="/title.png, /title.png 1.5x, /title.png 2x" data-sizes=auto alt=/title.png title=/title.png></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=找啥呢,给点提示让咱帮帮你... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friends/ title>友链</a><a class=menu-item href=/about/ title>关于</a><a class=menu-item href=https://github.com/phoon title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a class=menu-item href=/index.xml title=RSS><i class='fas fa-rss-square'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/post/2021/05/08/the-red-black-tree/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">红黑树那点事儿</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://blog.peven.me title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Peven</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/golang/><i class="far fa-folder fa-fw" aria-hidden=true></i>Golang</a>&nbsp;<a href=/categories/%E7%AE%97%E6%B3%95/><i class="far fa-folder fa-fw" aria-hidden=true></i>算法</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2021-05-08>2021-05-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 4441 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 9 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#0-写在前面>0. 写在前面</a></li><li><a href=#1-旋转以及颜色翻转的本质>1. 旋转以及颜色翻转的本质</a><ul><li><a href=#-旋转>Ⅰ. 旋转</a></li><li><a href=#-颜色翻转flip-color>Ⅱ. 颜色翻转（flip-color）</a></li></ul></li><li><a href=#2-平衡性维持>2. 平衡性维持</a><ul><li><a href=#-插入后的平衡性维持>Ⅰ. 插入后的平衡性维持</a><ul><li><a href=#a-新增一个2-结点>a. 新增一个2-结点</a></li><li><a href=#b-与一个2-结点合并成为3-结点>b. 与一个2-结点合并成为3-结点</a></li><li><a href=#c-与一个3-结点合并成为4-结点>c. 与一个3-结点合并成为4-结点</a></li><li><a href=#d-与一个4-结点进行合并-4-结点需要分裂颜色翻转>d. 与一个4-结点进行合并， 4-结点需要分裂（颜色翻转）</a></li></ul></li><li><a href=#-删除后的平衡性维持>Ⅱ. 删除后的平衡性维持</a><ul><li><a href=#a-兄弟够借>a. 兄弟够借</a></li><li><a href=#b-兄弟不够>b. 兄弟不够</a></li></ul></li></ul></li><li><a href=#3-代码实现>3. 代码实现</a></li><li><a href=#4-do-something-fun红黑树可视化>4. Do something fun：红黑树可视化</a></li><li><a href=#5-总结>5. 总结</a></li></ul></nav></div></div><div class=content id=content><blockquote><p>前置知识：二叉查找树、B树，本文不多做介绍。</p></blockquote><h2 id=0-写在前面>0. 写在前面</h2><p>在观察和思考红黑树时，一定要牢记：红黑树是一颗平衡二叉查找树，我们所赋予红黑树的一切行为，都是为了使其能够保持平衡性。</p><p>红黑树是由<code>2-3-4树</code>（4阶B树）等价过来的（当然也有由<code>2-3树</code>等价来的左倾或右倾红黑树），而这层等价关系，是我们用以维持红黑树平衡性的根本。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/h6DA5UabVoznLRC.jpg data-srcset="https://i.loli.net/2021/05/06/h6DA5UabVoznLRC.jpg, https://i.loli.net/2021/05/06/h6DA5UabVoznLRC.jpg 1.5x, https://i.loli.net/2021/05/06/h6DA5UabVoznLRC.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/h6DA5UabVoznLRC.jpg title=等价关系.jpeg></p><p>在红黑树中，我们以黑色来标识对应B树里的<code>2-结点</code>，而红色结点表示其<code>parent</code>到自己的链接是一条红链接（向上融合后对应B树中的<code>3-结点</code>，若兄弟结点也是红色则一起向上融合对应<code>4-结点</code>）</p><p>接下来我们来看看红黑树的五大性质：</p><ul><li>结点为红色或黑色</li><li>根为黑色</li><li>NULL叶子结点均为黑色</li><li>每个叶子结点到根的路径上不能有两个连续的红色结点</li><li>完美黑色平衡</li></ul><p>通过前面展示的等价关系，要推导出这几条性质不成问题。</p><h2 id=1-旋转以及颜色翻转的本质>1. 旋转以及颜色翻转的本质</h2><p>首先我们要明确一个概念：旋转是作用于红链接的操作。那么，旋转操作到底给我们的红黑树带来了怎样的影响呢？</p><h3 id=-旋转>Ⅰ. 旋转</h3><p>旋转分为左旋（<code>left-rotate</code>）和右旋（<code>right-rotate</code>）：</p><ul><li>左旋：将右红链接转换为左红链接</li><li>右旋：将左红链接转换为右红链接</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/PGNnhry5dsOc2D8.jpg data-srcset="https://i.loli.net/2021/05/06/PGNnhry5dsOc2D8.jpg, https://i.loli.net/2021/05/06/PGNnhry5dsOc2D8.jpg 1.5x, https://i.loli.net/2021/05/06/PGNnhry5dsOc2D8.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/PGNnhry5dsOc2D8.jpg title=rotate.jpg></p><p>可以看到：在经过旋转操作后，我们可以调节某一侧黑色结点的平衡，而对应的<code>2-3-4树</code>结点并未发生任何变化。</p><h3 id=-颜色翻转flip-color>Ⅱ. 颜色翻转（flip-color）</h3><p>颜色翻转其实对应的是<code>2-3-4树</code>中<code>4-结点</code>需要分裂时的情况：一个新的<code>KEY</code>想要加入<code>4-结点</code>，会导致原有的<code>4-结点</code>分裂，原来中间的<code>KEY</code>会提到上层进行融合。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/AbkSlQLrFh2OIV1.jpg data-srcset="https://i.loli.net/2021/05/06/AbkSlQLrFh2OIV1.jpg, https://i.loli.net/2021/05/06/AbkSlQLrFh2OIV1.jpg 1.5x, https://i.loli.net/2021/05/06/AbkSlQLrFh2OIV1.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/AbkSlQLrFh2OIV1.jpg title=flipColors.jpg></p><p>当我们插入<code>d</code>时，会形成一个临时<code>5-结点</code>，这时原先的<code>4-结点</code>将分裂，将<code>b</code>提上去进行融合（标为红色），当然，若此时<code>b</code>已经成为根节点，则进一步标为黑色。可以看到，我们通过简单的颜色翻转即可达到<code>2-3-4树</code>中结点分裂的效果。</p><h2 id=2-平衡性维持>2. 平衡性维持</h2><p>在我们按照二叉查找树的规则做完插入或删除操作之后，就要通过观察对应<code>2-3-4树</code>中的变化，对我们的红黑树进行等价的操作从而恢复对应关系（即维持红黑树的平衡性）。</p><h3 id=-插入后的平衡性维持>Ⅰ. 插入后的平衡性维持</h3><p>新的结点作为红色叶子结点插入到树中，无非为以下4种情况：</p><h4 id=a-新增一个2-结点>a. 新增一个2-结点</h4><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/Zdvp5jHaSq8JYEc.jpg data-srcset="https://i.loli.net/2021/05/06/Zdvp5jHaSq8JYEc.jpg, https://i.loli.net/2021/05/06/Zdvp5jHaSq8JYEc.jpg 1.5x, https://i.loli.net/2021/05/06/Zdvp5jHaSq8JYEc.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/Zdvp5jHaSq8JYEc.jpg title=2node.jpeg></p><p>如果新增的<code>2-结点</code>将作为根节点，则将其进一步标为黑色。</p><h4 id=b-与一个2-结点合并成为3-结点>b. 与一个2-结点合并成为3-结点</h4><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/JFkmLxbgrQTlit8.jpg data-srcset="https://i.loli.net/2021/05/06/JFkmLxbgrQTlit8.jpg, https://i.loli.net/2021/05/06/JFkmLxbgrQTlit8.jpg 1.5x, https://i.loli.net/2021/05/06/JFkmLxbgrQTlit8.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/JFkmLxbgrQTlit8.jpg title=3node.jpeg></p><p>即新结点的<code>parent</code>结点为黑色，无需调整。</p><h4 id=c-与一个3-结点合并成为4-结点>c. 与一个3-结点合并成为4-结点</h4><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/bJQ1nCwpxGOEVHI.jpg data-srcset="https://i.loli.net/2021/05/06/bJQ1nCwpxGOEVHI.jpg, https://i.loli.net/2021/05/06/bJQ1nCwpxGOEVHI.jpg 1.5x, https://i.loli.net/2021/05/06/bJQ1nCwpxGOEVHI.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/bJQ1nCwpxGOEVHI.jpg title=4node.jpeg></p><ul><li>图中黑色虚线方框内是插入新节点时其<code>parent</code>结点以及<code>grandparent</code>结点可能的情形</li><li>橙色三角标所指表示我们新插入的结点的位置</li></ul><p>可能会出现连续两条红链接的情况，这时需要通过旋转操作进行调整（为上图下半部分的形式）。</p><h4 id=d-与一个4-结点进行合并-4-结点需要分裂颜色翻转>d. 与一个4-结点进行合并， 4-结点需要分裂（颜色翻转）</h4><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/jwYiLDSHAP2huCB.jpg data-srcset="https://i.loli.net/2021/05/06/jwYiLDSHAP2huCB.jpg, https://i.loli.net/2021/05/06/jwYiLDSHAP2huCB.jpg 1.5x, https://i.loli.net/2021/05/06/jwYiLDSHAP2huCB.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/jwYiLDSHAP2huCB.jpg title=4node-split.jpeg></p><h3 id=-删除后的平衡性维持>Ⅱ. 删除后的平衡性维持</h3><p>删除操作同<code>BST</code>大体相同，不过在我们的代码实现里，被删除的永远是一个替代结点。因为红黑树由2-3-4树等价而来，我们要充分对其性质进行利用。</p><p>那么替代结点究竟如何得到呢？我们先查找到指定删除的结点<code>d</code>，如果该结点有两个孩子，则替代结点为其前驱或后继结点；如果该结点只有一个孩子，该孩子就是替代结点；若<code>d</code>没有孩子（即<code>d</code>为根结点），则替代结点就是其本身。</p><p>因为<code>2-3-4</code>树的完美平衡性质，我们可以得到一个结论：真正被删除的元素一定是<code>2-3-4树</code>中的叶子节点中的<code>KEY</code>，也即在红黑树中删除的（替代结点）一定是叶子节点或者叶子结点上面的双亲结点（最多只有一个孩子）。</p><p>进一步得出以下推论：若替代结点的左孩子不为空，则替代结点一定是一个前驱结点；反之，是一个后继结点。删除后用其子节点替代自己的位置。</p><p>而这又对应了<code>2-3-4树</code>中叶子结点的状况：</p><ul><li><code>2-结点</code>：删除后兄弟够借，经过双亲借；兄弟不够，啃老来凑</li><li>非<code>2-结点</code>：自己足够，直接删除</li></ul><p>而后我们的删除策略就变成了（以用前驱结点替代为例）：</p><ul><li>若删除的替代结点有孩子，且替代结点为黑色，将孩子变为黑色来替代自己</li><li>删除的是一个叶子节点，且这个替代结点为黑色，在删除前先进行平衡修复（避免提前删除导致信息丢失）</li></ul><p>接下来讨论上述第二种情况：需要平衡修复的情况。</p><h4 id=a-兄弟够借>a. 兄弟够借</h4><p>向兄弟结点借之前得先知道兄弟手里够不够吧，所以需要找到真正的兄弟结点，因为若当前替代结点的兄弟是红色结点的话，对应2-3-4树，在红黑树中根本不是真正的兄弟结点。如下图第二种情况（图中<code>p</code>表示<code>parent结点</code>哦）：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/ovUeGrXcxKSFwu5.jpg data-srcset="https://i.loli.net/2021/05/06/ovUeGrXcxKSFwu5.jpg, https://i.loli.net/2021/05/06/ovUeGrXcxKSFwu5.jpg 1.5x, https://i.loli.net/2021/05/06/ovUeGrXcxKSFwu5.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/ovUeGrXcxKSFwu5.jpg title=find-bro.jpeg></p><p>这时我们只需对替代结点的<code>parent</code>结点做一次旋转操作即可（出现红链接了）,如下所示：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/jgHPDvSGsUh86Ip.jpg data-srcset="https://i.loli.net/2021/05/06/jgHPDvSGsUh86Ip.jpg, https://i.loli.net/2021/05/06/jgHPDvSGsUh86Ip.jpg 1.5x, https://i.loli.net/2021/05/06/jgHPDvSGsUh86Ip.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/jgHPDvSGsUh86Ip.jpg title=find-real-bro.jpeg></p><p>找到真正的兄弟结点之后，如果兄弟结点的孩子中有红色结点，就对应了<code>2-3-4树</code>中非<code>2-结点</code>可借的情况。</p><p>既然兄弟够借，那么对应<code>2-3-4树</code>中，就是兄弟中<code>KEY</code>最接近自己的上去顶替<code>parent</code>，<code>parent</code>下来顶替被删的结点。</p><p>为了实现起来简单，这里有一个小trick：通过旋转将兄弟与兄弟孩子结点达到某种关系后，再旋转<code>parent</code>结点。这样做可以达到在对应<code>2-3-4树</code>中如果有兄弟有两个孩子就从兄弟那里借两个来的效果，而且可以大大的简化我们的代码。</p><p>例如被删结点是其<code>parent</code>的左孩子，找到其真正的右兄弟后，如果右兄弟有两个红色子节点，直接旋转<code>parent</code>，这样，兄弟结点中只会留下右孩子（较大的<code>KEY</code>），兄弟结点上升代替<code>parent</code>，<code>parent</code>与兄弟左孩子下来代替删除的结点，左孩子没有的话也没关系；另一种需要提前调整的情况是，右兄弟只有一个左孩子可借，这时候我们对右兄弟进行右旋后再对<code>parent</code>进行左旋即可。</p><p>然而我们前面说：旋转操作是针对红链接的。然而我们在这里其实很幸运地跳出了这个规则的束缚,只需做小许额外的步骤：</p><ul><li><p>对<code>parent</code>旋转之后， 兄弟顶上去替代<code>parent</code>的位置， 兄弟被染成了<code>parent</code>原来的颜色 —— 上去顶替,没毛病</p></li><li><p>但<code>parent</code>变成了红色，不过因为<code>parent</code>是下来顶替被删的黑色结点，故需将其染成黑色</p></li><li><p>最后，将兄弟结点之前的右孩子标为黑色 —— 只剩下它了，作为一个<code>2-结点</code></p></li></ul><p>若被删结点是其<code>parent</code>的右孩子，把上面的逻辑反过来左右对调即可。</p><p>如果真兄弟结点的两个孩子均为黑色，就对应了<code>2-结点</code>、不可借的情况，我们将在下面继续进行讨论。</p><h4 id=b-兄弟不够>b. 兄弟不够</h4><p>兄弟无法借过来，对应<code>2-3-4树</code>中，兄弟就得找<code>parent</code>合并。所以直接将兄弟结点变成红色，交由上层解决。若<code>parent</code>也是红色，就把<code>parent</code>变成黑色。若<code>parent</code>本身就是黑色，就得让<code>parent</code>再找他自己的兄弟结点借。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/08/ElLRvKUJpHVMZmk.jpg data-srcset="https://i.loli.net/2021/05/08/ElLRvKUJpHVMZmk.jpg, https://i.loli.net/2021/05/08/ElLRvKUJpHVMZmk.jpg 1.5x, https://i.loli.net/2021/05/08/ElLRvKUJpHVMZmk.jpg 2x" data-sizes=auto alt=https://i.loli.net/2021/05/08/ElLRvKUJpHVMZmk.jpg title=Delete.jpeg></p><h2 id=3-代码实现>3. 代码实现</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=ln>  1</span><span class=cl><span class=kn>package</span> <span class=nx>rbt</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl>
</span></span><span class=line><span class=ln>  3</span><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=ln>  4</span><span class=cl>	<span class=nx>RED</span>   <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl>	<span class=nx>BLACK</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl>
</span></span><span class=line><span class=ln>  8</span><span class=cl><span class=kd>type</span> <span class=p>(</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl>	<span class=c1>// KeyType is the type with CompareTo behavior.
</span></span></span><span class=line><span class=ln> 10</span><span class=cl><span class=c1></span>	<span class=nx>KeyType</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>		<span class=nf>CompareTo</span><span class=p>(</span><span class=nx>c</span> <span class=kd>interface</span><span class=p>{})</span> <span class=kt>int</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>
</span></span><span class=line><span class=ln> 14</span><span class=cl>	<span class=c1>// KeyTypeInt is the int that implements the KeyType interface.
</span></span></span><span class=line><span class=ln> 15</span><span class=cl><span class=c1></span>	<span class=nx>KeyTypeInt</span> <span class=kt>int</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>
</span></span><span class=line><span class=ln> 17</span><span class=cl>	<span class=c1>// node is the red-black tree node
</span></span></span><span class=line><span class=ln> 18</span><span class=cl><span class=c1></span>	<span class=nx>node</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl>		<span class=nx>Key</span>    <span class=nx>KeyType</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>		<span class=nx>Val</span>    <span class=kd>interface</span><span class=p>{}</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl>		<span class=nx>Color</span>  <span class=kt>bool</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>		<span class=nx>Left</span>   <span class=o>*</span><span class=nx>node</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>		<span class=nx>Right</span>  <span class=o>*</span><span class=nx>node</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl>		<span class=nx>Parent</span> <span class=o>*</span><span class=nx>node</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl>
</span></span><span class=line><span class=ln> 27</span><span class=cl>	<span class=c1>// RBT is the red-black tree
</span></span></span><span class=line><span class=ln> 28</span><span class=cl><span class=c1></span>	<span class=nx>RBT</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>		<span class=nx>root</span> <span class=o>*</span><span class=nx>node</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl>		<span class=nx>size</span> <span class=kt>int</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl>
</span></span><span class=line><span class=ln> 34</span><span class=cl><span class=c1>// CompareTo implementation for type KeyTypeInt
</span></span></span><span class=line><span class=ln> 35</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>k</span> <span class=nx>KeyTypeInt</span><span class=p>)</span> <span class=nf>CompareTo</span><span class=p>(</span><span class=nx>c</span> <span class=kd>interface</span><span class=p>{})</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>	<span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=nx>k</span><span class=p>)</span> <span class=o>-</span> <span class=nb>int</span><span class=p>(</span><span class=nx>c</span><span class=p>.(</span><span class=nx>KeyTypeInt</span><span class=p>))</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>
</span></span><span class=line><span class=ln> 39</span><span class=cl><span class=c1>// isRed returns whether a node is in red color, nil is black
</span></span></span><span class=line><span class=ln> 40</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>isRed</span><span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>node</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>	<span class=k>if</span> <span class=nx>n</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>		<span class=k>return</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl>	<span class=k>return</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Color</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>
</span></span><span class=line><span class=ln> 47</span><span class=cl><span class=c1>// NewRBT returns a red-black tree
</span></span></span><span class=line><span class=ln> 48</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>NewRBT</span><span class=p>()</span> <span class=o>*</span><span class=nx>RBT</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>RBT</span><span class=p>{}</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl>
</span></span><span class=line><span class=ln> 52</span><span class=cl><span class=c1>// treeMin find the minimum node in n&#39;s sub-tree
</span></span></span><span class=line><span class=ln> 53</span><span class=cl><span class=c1>// func (n *node) treeMin() *node {
</span></span></span><span class=line><span class=ln> 54</span><span class=cl><span class=c1>// 	for n.Left != nil {
</span></span></span><span class=line><span class=ln> 55</span><span class=cl><span class=c1>// 		n = n.Left
</span></span></span><span class=line><span class=ln> 56</span><span class=cl><span class=c1>// 	}
</span></span></span><span class=line><span class=ln> 57</span><span class=cl><span class=c1>// 	return n
</span></span></span><span class=line><span class=ln> 58</span><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=ln> 59</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln> 60</span><span class=cl><span class=c1>// treeMax find the maximum node in n&#39;s sub-tree
</span></span></span><span class=line><span class=ln> 61</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>node</span><span class=p>)</span> <span class=nf>treeMax</span><span class=p>()</span> <span class=o>*</span><span class=nx>node</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>	<span class=k>for</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Right</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>		<span class=nx>n</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>	<span class=k>return</span> <span class=nx>n</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl>
</span></span><span class=line><span class=ln> 68</span><span class=cl><span class=c1>// predecessor returns n&#39;s predecessor node
</span></span></span><span class=line><span class=ln> 69</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>node</span><span class=p>)</span> <span class=nf>predecessor</span><span class=p>()</span> <span class=o>*</span><span class=nx>node</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl>	<span class=k>if</span> <span class=nx>n</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl>		<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl>
</span></span><span class=line><span class=ln> 74</span><span class=cl>	<span class=k>if</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Left</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>		<span class=k>return</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Left</span><span class=p>.</span><span class=nf>treeMax</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 76</span><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl>		<span class=nx>p</span> <span class=o>:=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>		<span class=nx>lc</span> <span class=o>:=</span> <span class=nx>n</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl>		<span class=k>for</span> <span class=nx>p</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=o>&amp;&amp;</span> <span class=nx>lc</span> <span class=o>==</span> <span class=nx>p</span><span class=p>.</span><span class=nx>Left</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>			<span class=nx>lc</span> <span class=p>=</span> <span class=nx>p</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl>			<span class=nx>p</span> <span class=p>=</span> <span class=nx>p</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl>		<span class=k>return</span> <span class=nx>p</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl>
</span></span><span class=line><span class=ln> 87</span><span class=cl><span class=c1>// successor returns n&#39;s successor node
</span></span></span><span class=line><span class=ln> 88</span><span class=cl><span class=c1>// func (n *node) successor() *node {
</span></span></span><span class=line><span class=ln> 89</span><span class=cl><span class=c1>// 	if n == nil {
</span></span></span><span class=line><span class=ln> 90</span><span class=cl><span class=c1>// 		return nil
</span></span></span><span class=line><span class=ln> 91</span><span class=cl><span class=c1>// 	}
</span></span></span><span class=line><span class=ln> 92</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln> 93</span><span class=cl><span class=c1>// 	if n.Right != nil {
</span></span></span><span class=line><span class=ln> 94</span><span class=cl><span class=c1>// 		return n.Right.treeMin()
</span></span></span><span class=line><span class=ln> 95</span><span class=cl><span class=c1>// 	} else {
</span></span></span><span class=line><span class=ln> 96</span><span class=cl><span class=c1>// 		p := n.Parent
</span></span></span><span class=line><span class=ln> 97</span><span class=cl><span class=c1>// 		lc := n
</span></span></span><span class=line><span class=ln> 98</span><span class=cl><span class=c1>// 		for p != nil &amp;&amp; lc == p.Right {
</span></span></span><span class=line><span class=ln> 99</span><span class=cl><span class=c1>// 			lc = p
</span></span></span><span class=line><span class=ln>100</span><span class=cl><span class=c1>// 			p = p.Parent
</span></span></span><span class=line><span class=ln>101</span><span class=cl><span class=c1>// 		}
</span></span></span><span class=line><span class=ln>102</span><span class=cl><span class=c1>// 		return p
</span></span></span><span class=line><span class=ln>103</span><span class=cl><span class=c1>// 	}
</span></span></span><span class=line><span class=ln>104</span><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=ln>105</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>106</span><span class=cl><span class=c1>// LeftRotate left rotate the node n, acting on a red link
</span></span></span><span class=line><span class=ln>107</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln>108</span><span class=cl><span class=c1>//    p               p
</span></span></span><span class=line><span class=ln>109</span><span class=cl><span class=c1>//    |               |
</span></span></span><span class=line><span class=ln>110</span><span class=cl><span class=c1>//    n               m
</span></span></span><span class=line><span class=ln>111</span><span class=cl><span class=c1>//   / \             / \
</span></span></span><span class=line><span class=ln>112</span><span class=cl><span class=c1>//  nl  m    ==&gt;    n  mr
</span></span></span><span class=line><span class=ln>113</span><span class=cl><span class=c1>//     / \         / \
</span></span></span><span class=line><span class=ln>114</span><span class=cl><span class=c1>//    ml mr       nl ml
</span></span></span><span class=line><span class=ln>115</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln>116</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>RBT</span><span class=p>)</span> <span class=nf>leftRotate</span><span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>	<span class=nx>m</span> <span class=o>:=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln>118</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Right</span> <span class=p>=</span> <span class=nx>m</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>119</span><span class=cl>	<span class=k>if</span> <span class=nx>m</span><span class=p>.</span><span class=nx>Left</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>120</span><span class=cl>		<span class=nx>m</span><span class=p>.</span><span class=nx>Left</span><span class=p>.</span><span class=nx>Parent</span> <span class=p>=</span> <span class=nx>n</span>
</span></span><span class=line><span class=ln>121</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>122</span><span class=cl>	<span class=nx>m</span><span class=p>.</span><span class=nx>Parent</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln>123</span><span class=cl>	<span class=k>if</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>124</span><span class=cl>		<span class=nx>t</span><span class=p>.</span><span class=nx>root</span> <span class=p>=</span> <span class=nx>m</span>
</span></span><span class=line><span class=ln>125</span><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>n</span> <span class=o>==</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>126</span><span class=cl>		<span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>=</span> <span class=nx>m</span>
</span></span><span class=line><span class=ln>127</span><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>128</span><span class=cl>		<span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Right</span> <span class=p>=</span> <span class=nx>m</span>
</span></span><span class=line><span class=ln>129</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>130</span><span class=cl>	<span class=nx>m</span><span class=p>.</span><span class=nx>Left</span> <span class=p>=</span> <span class=nx>n</span>
</span></span><span class=line><span class=ln>131</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span> <span class=p>=</span> <span class=nx>m</span>
</span></span><span class=line><span class=ln>132</span><span class=cl>	<span class=c1>// repaint color
</span></span></span><span class=line><span class=ln>133</span><span class=cl><span class=c1></span>	<span class=nx>m</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Color</span>
</span></span><span class=line><span class=ln>134</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>RED</span>
</span></span><span class=line><span class=ln>135</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>136</span><span class=cl>
</span></span><span class=line><span class=ln>137</span><span class=cl><span class=c1>// RightRotate right rotate the node n, acting on a red link
</span></span></span><span class=line><span class=ln>138</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln>139</span><span class=cl><span class=c1>//     p                p
</span></span></span><span class=line><span class=ln>140</span><span class=cl><span class=c1>//     |                |
</span></span></span><span class=line><span class=ln>141</span><span class=cl><span class=c1>//     n                m
</span></span></span><span class=line><span class=ln>142</span><span class=cl><span class=c1>//    / \              / \
</span></span></span><span class=line><span class=ln>143</span><span class=cl><span class=c1>//   m  nr    ==&gt;     ml  n
</span></span></span><span class=line><span class=ln>144</span><span class=cl><span class=c1>//  / \                  / \
</span></span></span><span class=line><span class=ln>145</span><span class=cl><span class=c1>// ml mr                mr nr
</span></span></span><span class=line><span class=ln>146</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln>147</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>RBT</span><span class=p>)</span> <span class=nf>rightRotate</span><span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>148</span><span class=cl>	<span class=nx>m</span> <span class=o>:=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>149</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Left</span> <span class=p>=</span> <span class=nx>m</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln>150</span><span class=cl>	<span class=k>if</span> <span class=nx>m</span><span class=p>.</span><span class=nx>Right</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>151</span><span class=cl>		<span class=nx>m</span><span class=p>.</span><span class=nx>Right</span><span class=p>.</span><span class=nx>Parent</span> <span class=p>=</span> <span class=nx>n</span>
</span></span><span class=line><span class=ln>152</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>153</span><span class=cl>	<span class=nx>m</span><span class=p>.</span><span class=nx>Parent</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln>154</span><span class=cl>	<span class=k>if</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>155</span><span class=cl>		<span class=nx>t</span><span class=p>.</span><span class=nx>root</span> <span class=p>=</span> <span class=nx>m</span>
</span></span><span class=line><span class=ln>156</span><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>n</span> <span class=o>==</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>157</span><span class=cl>		<span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>=</span> <span class=nx>m</span>
</span></span><span class=line><span class=ln>158</span><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>159</span><span class=cl>		<span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Right</span> <span class=p>=</span> <span class=nx>m</span>
</span></span><span class=line><span class=ln>160</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>161</span><span class=cl>
</span></span><span class=line><span class=ln>162</span><span class=cl>	<span class=nx>m</span><span class=p>.</span><span class=nx>Right</span> <span class=p>=</span> <span class=nx>n</span>
</span></span><span class=line><span class=ln>163</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span> <span class=p>=</span> <span class=nx>m</span>
</span></span><span class=line><span class=ln>164</span><span class=cl>	<span class=c1>// repaint color
</span></span></span><span class=line><span class=ln>165</span><span class=cl><span class=c1></span>	<span class=nx>m</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Color</span>
</span></span><span class=line><span class=ln>166</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>RED</span>
</span></span><span class=line><span class=ln>167</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>168</span><span class=cl>
</span></span><span class=line><span class=ln>169</span><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>RBT</span><span class=p>)</span> <span class=nf>flipColors</span><span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>170</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>RED</span>
</span></span><span class=line><span class=ln>171</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Left</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln>172</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Right</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln>173</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>174</span><span class=cl>
</span></span><span class=line><span class=ln>175</span><span class=cl><span class=c1>// Search returns the node by the given key if it exists
</span></span></span><span class=line><span class=ln>176</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>RBT</span><span class=p>)</span> <span class=nf>Search</span><span class=p>(</span><span class=nx>key</span> <span class=nx>KeyType</span><span class=p>)</span> <span class=o>*</span><span class=nx>node</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>177</span><span class=cl>	<span class=nx>root</span> <span class=o>:=</span> <span class=nx>t</span><span class=p>.</span><span class=nx>root</span>
</span></span><span class=line><span class=ln>178</span><span class=cl>	<span class=k>for</span> <span class=nx>root</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>179</span><span class=cl>		<span class=nx>cmp</span> <span class=o>:=</span> <span class=nx>key</span><span class=p>.</span><span class=nf>CompareTo</span><span class=p>(</span><span class=nx>root</span><span class=p>.</span><span class=nx>Key</span><span class=p>)</span>
</span></span><span class=line><span class=ln>180</span><span class=cl>		<span class=k>if</span> <span class=nx>cmp</span> <span class=p>&lt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>181</span><span class=cl>			<span class=nx>root</span> <span class=p>=</span> <span class=nx>root</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>182</span><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>cmp</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>183</span><span class=cl>			<span class=nx>root</span> <span class=p>=</span> <span class=nx>root</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln>184</span><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>185</span><span class=cl>			<span class=k>return</span> <span class=nx>root</span>
</span></span><span class=line><span class=ln>186</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>187</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>188</span><span class=cl>	<span class=k>return</span> <span class=nx>root</span>
</span></span><span class=line><span class=ln>189</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>190</span><span class=cl>
</span></span><span class=line><span class=ln>191</span><span class=cl><span class=c1>// Insert inserts a key with associated data(val) to a place in the red-black
</span></span></span><span class=line><span class=ln>192</span><span class=cl><span class=c1>// tree by compare the keys, and if the key exists, update it with the new val.
</span></span></span><span class=line><span class=ln>193</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>RBT</span><span class=p>)</span> <span class=nf>Insert</span><span class=p>(</span><span class=nx>key</span> <span class=nx>KeyType</span><span class=p>,</span> <span class=nx>val</span> <span class=kd>interface</span><span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>194</span><span class=cl>	<span class=k>if</span> <span class=nx>t</span><span class=p>.</span><span class=nx>root</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>195</span><span class=cl>		<span class=nx>t</span><span class=p>.</span><span class=nx>root</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>node</span><span class=p>{</span><span class=nx>Key</span><span class=p>:</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>Val</span><span class=p>:</span> <span class=nx>val</span><span class=p>}</span>
</span></span><span class=line><span class=ln>196</span><span class=cl>		<span class=nx>t</span><span class=p>.</span><span class=nx>size</span> <span class=p>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=ln>197</span><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=ln>198</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>199</span><span class=cl>
</span></span><span class=line><span class=ln>200</span><span class=cl>	<span class=c1>// find parent node to attach
</span></span></span><span class=line><span class=ln>201</span><span class=cl><span class=c1></span>	<span class=nx>root</span> <span class=o>:=</span> <span class=nx>t</span><span class=p>.</span><span class=nx>root</span>
</span></span><span class=line><span class=ln>202</span><span class=cl>	<span class=kd>var</span> <span class=nx>p</span> <span class=o>*</span><span class=nx>node</span>
</span></span><span class=line><span class=ln>203</span><span class=cl>	<span class=k>for</span> <span class=nx>root</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>204</span><span class=cl>		<span class=nx>p</span> <span class=p>=</span> <span class=nx>root</span>
</span></span><span class=line><span class=ln>205</span><span class=cl>		<span class=nx>cmp</span> <span class=o>:=</span> <span class=nx>key</span><span class=p>.</span><span class=nf>CompareTo</span><span class=p>(</span><span class=nx>root</span><span class=p>.</span><span class=nx>Key</span><span class=p>)</span>
</span></span><span class=line><span class=ln>206</span><span class=cl>		<span class=k>if</span> <span class=nx>cmp</span> <span class=p>&lt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>207</span><span class=cl>			<span class=nx>root</span> <span class=p>=</span> <span class=nx>root</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>208</span><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>cmp</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>209</span><span class=cl>			<span class=nx>root</span> <span class=p>=</span> <span class=nx>root</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln>210</span><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>211</span><span class=cl>			<span class=nx>root</span><span class=p>.</span><span class=nx>Val</span> <span class=p>=</span> <span class=nx>val</span>
</span></span><span class=line><span class=ln>212</span><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=ln>213</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>214</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>215</span><span class=cl>
</span></span><span class=line><span class=ln>216</span><span class=cl>	<span class=nx>newnode</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>node</span><span class=p>{</span><span class=nx>Key</span><span class=p>:</span> <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=ln>217</span><span class=cl>		<span class=nx>Val</span><span class=p>:</span>    <span class=nx>val</span><span class=p>,</span>
</span></span><span class=line><span class=ln>218</span><span class=cl>		<span class=nx>Color</span><span class=p>:</span>  <span class=nx>RED</span><span class=p>,</span>
</span></span><span class=line><span class=ln>219</span><span class=cl>		<span class=nx>Parent</span><span class=p>:</span> <span class=nx>p</span><span class=p>,</span>
</span></span><span class=line><span class=ln>220</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>221</span><span class=cl>
</span></span><span class=line><span class=ln>222</span><span class=cl>	<span class=nx>cmp</span> <span class=o>:=</span> <span class=nx>key</span><span class=p>.</span><span class=nf>CompareTo</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>Key</span><span class=p>)</span>
</span></span><span class=line><span class=ln>223</span><span class=cl>	<span class=k>if</span> <span class=nx>cmp</span> <span class=p>&lt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>224</span><span class=cl>		<span class=nx>p</span><span class=p>.</span><span class=nx>Left</span> <span class=p>=</span> <span class=nx>newnode</span>
</span></span><span class=line><span class=ln>225</span><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>226</span><span class=cl>		<span class=nx>p</span><span class=p>.</span><span class=nx>Right</span> <span class=p>=</span> <span class=nx>newnode</span>
</span></span><span class=line><span class=ln>227</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>228</span><span class=cl>
</span></span><span class=line><span class=ln>229</span><span class=cl>	<span class=nx>t</span><span class=p>.</span><span class=nf>insertFix</span><span class=p>(</span><span class=nx>newnode</span><span class=p>)</span>
</span></span><span class=line><span class=ln>230</span><span class=cl>	<span class=nx>t</span><span class=p>.</span><span class=nx>size</span><span class=o>++</span>
</span></span><span class=line><span class=ln>231</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>232</span><span class=cl>
</span></span><span class=line><span class=ln>233</span><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>RBT</span><span class=p>)</span> <span class=nf>insertFix</span><span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>234</span><span class=cl>	<span class=kd>var</span> <span class=nx>u</span> <span class=o>*</span><span class=nx>node</span> <span class=c1>// n&#39;s uncle node
</span></span></span><span class=line><span class=ln>235</span><span class=cl><span class=c1></span>	<span class=k>for</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=o>&amp;&amp;</span> <span class=nf>isRed</span><span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>236</span><span class=cl>		<span class=k>if</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span> <span class=o>==</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>237</span><span class=cl>			<span class=nx>u</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln>238</span><span class=cl>			<span class=k>if</span> <span class=nx>u</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=o>&amp;&amp;</span> <span class=nf>isRed</span><span class=p>(</span><span class=nx>u</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>239</span><span class=cl>				<span class=nx>n</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln>240</span><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>flipColors</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=ln>241</span><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>242</span><span class=cl>				<span class=k>if</span> <span class=nx>n</span> <span class=o>==</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Right</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>243</span><span class=cl>					<span class=nx>n</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln>244</span><span class=cl>					<span class=nx>t</span><span class=p>.</span><span class=nf>leftRotate</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=ln>245</span><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=ln>246</span><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>rightRotate</span><span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Parent</span><span class=p>)</span>
</span></span><span class=line><span class=ln>247</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>248</span><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>249</span><span class=cl>			<span class=nx>u</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>250</span><span class=cl>			<span class=k>if</span> <span class=nx>u</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=o>&amp;&amp;</span> <span class=nf>isRed</span><span class=p>(</span><span class=nx>u</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>251</span><span class=cl>				<span class=nx>n</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln>252</span><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>flipColors</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=ln>253</span><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>254</span><span class=cl>				<span class=k>if</span> <span class=nx>n</span> <span class=o>==</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>255</span><span class=cl>					<span class=nx>n</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln>256</span><span class=cl>					<span class=nx>t</span><span class=p>.</span><span class=nf>rightRotate</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=ln>257</span><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=ln>258</span><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>leftRotate</span><span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Parent</span><span class=p>)</span>
</span></span><span class=line><span class=ln>259</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>260</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>261</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>262</span><span class=cl>	<span class=c1>// root should be black node at the end
</span></span></span><span class=line><span class=ln>263</span><span class=cl><span class=c1></span>	<span class=nx>t</span><span class=p>.</span><span class=nx>root</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln>264</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>265</span><span class=cl>
</span></span><span class=line><span class=ln>266</span><span class=cl><span class=c1>// Remove delete a node by the given key if it exits
</span></span></span><span class=line><span class=ln>267</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>RBT</span><span class=p>)</span> <span class=nf>Remove</span><span class=p>(</span><span class=nx>key</span> <span class=nx>KeyType</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>268</span><span class=cl>	<span class=nx>d</span> <span class=o>:=</span> <span class=nx>t</span><span class=p>.</span><span class=nf>Search</span><span class=p>(</span><span class=nx>key</span><span class=p>)</span>
</span></span><span class=line><span class=ln>269</span><span class=cl>
</span></span><span class=line><span class=ln>270</span><span class=cl>	<span class=k>if</span> <span class=nx>d</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>271</span><span class=cl>		<span class=k>return</span> <span class=c1>// not found
</span></span></span><span class=line><span class=ln>272</span><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=ln>273</span><span class=cl>
</span></span><span class=line><span class=ln>274</span><span class=cl>	<span class=c1>// find replacement node
</span></span></span><span class=line><span class=ln>275</span><span class=cl><span class=c1></span>	<span class=c1>// in our code, if finally the rpl hold a child node, the rpl must be a
</span></span></span><span class=line><span class=ln>276</span><span class=cl><span class=c1></span>	<span class=c1>// predecessor or successor
</span></span></span><span class=line><span class=ln>277</span><span class=cl><span class=c1></span>	<span class=nx>rpl</span> <span class=o>:=</span> <span class=nx>d</span>
</span></span><span class=line><span class=ln>278</span><span class=cl>	<span class=k>if</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Left</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=o>&amp;&amp;</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Right</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>279</span><span class=cl>		<span class=c1>// rpl = rpl.successor()
</span></span></span><span class=line><span class=ln>280</span><span class=cl><span class=c1></span>		<span class=nx>rpl</span> <span class=p>=</span> <span class=nx>rpl</span><span class=p>.</span><span class=nf>predecessor</span><span class=p>()</span>
</span></span><span class=line><span class=ln>281</span><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>282</span><span class=cl>		<span class=k>if</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Left</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>283</span><span class=cl>			<span class=nx>rpl</span> <span class=p>=</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>284</span><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Right</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>285</span><span class=cl>			<span class=nx>rpl</span> <span class=p>=</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln>286</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>287</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>288</span><span class=cl>	<span class=c1>// delete replacement node
</span></span></span><span class=line><span class=ln>289</span><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>rpl</span> <span class=o>!=</span> <span class=nx>t</span><span class=p>.</span><span class=nx>root</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>290</span><span class=cl>		<span class=k>if</span> <span class=nx>d</span> <span class=o>!=</span> <span class=nx>rpl</span> <span class=p>{</span> <span class=c1>// d is not a leaf node
</span></span></span><span class=line><span class=ln>291</span><span class=cl><span class=c1></span>			<span class=nx>d</span><span class=p>.</span><span class=nx>Key</span> <span class=p>=</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Key</span>
</span></span><span class=line><span class=ln>292</span><span class=cl>			<span class=nx>d</span><span class=p>.</span><span class=nx>Val</span> <span class=p>=</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Val</span>
</span></span><span class=line><span class=ln>293</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>294</span><span class=cl>
</span></span><span class=line><span class=ln>295</span><span class=cl>		<span class=k>if</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Left</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span> <span class=c1>// rpl is a predecessor
</span></span></span><span class=line><span class=ln>296</span><span class=cl><span class=c1></span>			<span class=k>if</span> <span class=p>!</span><span class=nf>isRed</span><span class=p>(</span><span class=nx>rpl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>297</span><span class=cl>				<span class=nx>rpl</span><span class=p>.</span><span class=nx>Left</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln>298</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>299</span><span class=cl>
</span></span><span class=line><span class=ln>300</span><span class=cl>			<span class=nx>rpl</span><span class=p>.</span><span class=nx>Left</span><span class=p>.</span><span class=nx>Parent</span> <span class=p>=</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln>301</span><span class=cl>			<span class=k>if</span> <span class=nx>rpl</span> <span class=o>==</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>302</span><span class=cl>				<span class=nx>rpl</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>=</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>303</span><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>304</span><span class=cl>				<span class=nx>rpl</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Right</span> <span class=p>=</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>305</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>306</span><span class=cl>			<span class=c1>// unlink rpl
</span></span></span><span class=line><span class=ln>307</span><span class=cl><span class=c1></span>			<span class=nx>rpl</span><span class=p>.</span><span class=nx>Parent</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=ln>308</span><span class=cl>			<span class=nx>rpl</span><span class=p>.</span><span class=nx>Left</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=ln>309</span><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>310</span><span class=cl>			<span class=c1>// rpl is a leaf node
</span></span></span><span class=line><span class=ln>311</span><span class=cl><span class=c1></span>			<span class=c1>// fix
</span></span></span><span class=line><span class=ln>312</span><span class=cl><span class=c1></span>			<span class=k>if</span> <span class=p>!</span><span class=nf>isRed</span><span class=p>(</span><span class=nx>rpl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>313</span><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>removeFix</span><span class=p>(</span><span class=nx>rpl</span><span class=p>)</span>
</span></span><span class=line><span class=ln>314</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>315</span><span class=cl>			<span class=c1>// then delete
</span></span></span><span class=line><span class=ln>316</span><span class=cl><span class=c1></span>			<span class=k>if</span> <span class=nx>rpl</span> <span class=o>==</span> <span class=nx>rpl</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>317</span><span class=cl>				<span class=nx>rpl</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=ln>318</span><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>319</span><span class=cl>				<span class=nx>rpl</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Right</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=ln>320</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>321</span><span class=cl>			<span class=c1>// unlink rpl
</span></span></span><span class=line><span class=ln>322</span><span class=cl><span class=c1></span>			<span class=nx>rpl</span><span class=p>.</span><span class=nx>Parent</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=ln>323</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>324</span><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span> <span class=c1>// single node tree
</span></span></span><span class=line><span class=ln>325</span><span class=cl><span class=c1></span>		<span class=nx>t</span><span class=p>.</span><span class=nx>root</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=ln>326</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>327</span><span class=cl>	<span class=nx>t</span><span class=p>.</span><span class=nx>size</span><span class=o>--</span>
</span></span><span class=line><span class=ln>328</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>329</span><span class=cl>
</span></span><span class=line><span class=ln>330</span><span class=cl><span class=c1>// fixAfterRemove do fix if the deleted node is in black color
</span></span></span><span class=line><span class=ln>331</span><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>RBT</span><span class=p>)</span> <span class=nf>removeFix</span><span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>332</span><span class=cl>	<span class=k>for</span> <span class=nx>n</span> <span class=o>!=</span> <span class=nx>t</span><span class=p>.</span><span class=nx>root</span> <span class=o>&amp;&amp;</span> <span class=p>!</span><span class=nf>isRed</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>333</span><span class=cl>		<span class=k>if</span> <span class=nx>n</span> <span class=o>==</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>334</span><span class=cl>			<span class=nx>rBro</span> <span class=o>:=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln>335</span><span class=cl>			<span class=c1>// find real brother node
</span></span></span><span class=line><span class=ln>336</span><span class=cl><span class=c1></span>			<span class=k>if</span> <span class=nf>isRed</span><span class=p>(</span><span class=nx>rBro</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>337</span><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>leftRotate</span><span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>)</span>
</span></span><span class=line><span class=ln>338</span><span class=cl>				<span class=nx>rBro</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln>339</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>340</span><span class=cl>			<span class=k>if</span> <span class=p>!</span><span class=nf>isRed</span><span class=p>(</span><span class=nx>rBro</span><span class=p>.</span><span class=nx>Left</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>!</span><span class=nf>isRed</span><span class=p>(</span><span class=nx>rBro</span><span class=p>.</span><span class=nx>Right</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// can&#39;t borrow
</span></span></span><span class=line><span class=ln>341</span><span class=cl><span class=c1></span>				<span class=nx>rBro</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>RED</span>
</span></span><span class=line><span class=ln>342</span><span class=cl>				<span class=nx>n</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln>343</span><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span> <span class=c1>// can borrow
</span></span></span><span class=line><span class=ln>344</span><span class=cl><span class=c1></span>				<span class=c1>// 3-node
</span></span></span><span class=line><span class=ln>345</span><span class=cl><span class=c1></span>				<span class=k>if</span> <span class=p>!</span><span class=nf>isRed</span><span class=p>(</span><span class=nx>rBro</span><span class=p>.</span><span class=nx>Right</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>346</span><span class=cl>					<span class=nx>t</span><span class=p>.</span><span class=nf>rightRotate</span><span class=p>(</span><span class=nx>rBro</span><span class=p>)</span>
</span></span><span class=line><span class=ln>347</span><span class=cl>					<span class=nx>rBro</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Right</span>
</span></span><span class=line><span class=ln>348</span><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=ln>349</span><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>leftRotate</span><span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>)</span>
</span></span><span class=line><span class=ln>350</span><span class=cl>				<span class=c1>// since we pull down n&#39;s parent to replace n and
</span></span></span><span class=line><span class=ln>351</span><span class=cl><span class=c1></span>				<span class=c1>// we borrow two n&#39;s bro&#39;s childern, we need repaint
</span></span></span><span class=line><span class=ln>352</span><span class=cl><span class=c1></span>				<span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln>353</span><span class=cl>				<span class=nx>rBro</span><span class=p>.</span><span class=nx>Right</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln>354</span><span class=cl>				<span class=nx>n</span> <span class=p>=</span> <span class=nx>t</span><span class=p>.</span><span class=nx>root</span>
</span></span><span class=line><span class=ln>355</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>356</span><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>357</span><span class=cl>			<span class=nx>lBro</span> <span class=o>:=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>358</span><span class=cl>
</span></span><span class=line><span class=ln>359</span><span class=cl>			<span class=k>if</span> <span class=nf>isRed</span><span class=p>(</span><span class=nx>lBro</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>360</span><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>rightRotate</span><span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>)</span>
</span></span><span class=line><span class=ln>361</span><span class=cl>				<span class=nx>lBro</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>362</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>363</span><span class=cl>			<span class=k>if</span> <span class=p>!</span><span class=nf>isRed</span><span class=p>(</span><span class=nx>lBro</span><span class=p>.</span><span class=nx>Left</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>!</span><span class=nf>isRed</span><span class=p>(</span><span class=nx>lBro</span><span class=p>.</span><span class=nx>Right</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>364</span><span class=cl>				<span class=nx>lBro</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>RED</span>
</span></span><span class=line><span class=ln>365</span><span class=cl>				<span class=nx>n</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span>
</span></span><span class=line><span class=ln>366</span><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>367</span><span class=cl>				<span class=k>if</span> <span class=p>!</span><span class=nf>isRed</span><span class=p>(</span><span class=nx>lBro</span><span class=p>.</span><span class=nx>Left</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>368</span><span class=cl>					<span class=nx>t</span><span class=p>.</span><span class=nf>leftRotate</span><span class=p>(</span><span class=nx>lBro</span><span class=p>)</span>
</span></span><span class=line><span class=ln>369</span><span class=cl>					<span class=nx>lBro</span> <span class=p>=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Left</span>
</span></span><span class=line><span class=ln>370</span><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=ln>371</span><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>rightRotate</span><span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>)</span>
</span></span><span class=line><span class=ln>372</span><span class=cl>				<span class=nx>n</span><span class=p>.</span><span class=nx>Parent</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln>373</span><span class=cl>				<span class=nx>lBro</span><span class=p>.</span><span class=nx>Left</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln>374</span><span class=cl>				<span class=nx>n</span> <span class=p>=</span> <span class=nx>t</span><span class=p>.</span><span class=nx>root</span>
</span></span><span class=line><span class=ln>375</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>376</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>377</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>378</span><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>Color</span> <span class=p>=</span> <span class=nx>BLACK</span>
</span></span><span class=line><span class=ln>379</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=4-do-something-fun红黑树可视化>4. Do something fun：红黑树可视化</h2><p>用<a href=https://github.com/mzohreva/GoGraphviz target=_blank rel="noopener noreffer">graphviz</a>库（需自行安装<code>dot</code>工具包）给我们的红黑树实现了<code>Visualize</code>方法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=ln> 1</span><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>RBT</span><span class=p>)</span> <span class=nf>Visualize</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>	<span class=nx>G</span> <span class=o>:=</span> <span class=nf>visuzlizeTree</span><span class=p>(</span><span class=nx>t</span><span class=p>.</span><span class=nx>root</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>	<span class=nx>G</span><span class=p>.</span><span class=nf>GenerateImage</span><span class=p>(</span><span class=s>&#34;dot&#34;</span><span class=p>,</span> <span class=s>&#34;rbt.svg&#34;</span><span class=p>,</span> <span class=s>&#34;svg&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=kd>func</span> <span class=nf>visuzlizeTree</span><span class=p>(</span><span class=nx>root</span> <span class=o>*</span><span class=nx>node</span><span class=p>)</span> <span class=o>*</span><span class=nx>graphviz</span><span class=p>.</span><span class=nx>Graph</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>	<span class=nx>G</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>graphviz</span><span class=p>.</span><span class=nx>Graph</span><span class=p>{}</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>	<span class=nf>addSubTree</span><span class=p>(</span><span class=nx>root</span><span class=p>,</span> <span class=nx>G</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>	<span class=nx>G</span><span class=p>.</span><span class=nf>DefaultNodeAttribute</span><span class=p>(</span><span class=nx>graphviz</span><span class=p>.</span><span class=nx>Shape</span><span class=p>,</span> <span class=nx>graphviz</span><span class=p>.</span><span class=nx>ShapeCircle</span><span class=p>)</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>	<span class=nx>G</span><span class=p>.</span><span class=nf>DefaultNodeAttribute</span><span class=p>(</span><span class=nx>graphviz</span><span class=p>.</span><span class=nx>FontName</span><span class=p>,</span> <span class=s>&#34;JetBrainsMono Nerd Font&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>	<span class=nx>G</span><span class=p>.</span><span class=nf>GraphAttribute</span><span class=p>(</span><span class=nx>graphviz</span><span class=p>.</span><span class=nx>NodeSep</span><span class=p>,</span> <span class=s>&#34;0.3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>	<span class=nx>G</span><span class=p>.</span><span class=nf>DefaultNodeAttribute</span><span class=p>(</span><span class=nx>graphviz</span><span class=p>.</span><span class=nx>Style</span><span class=p>,</span> <span class=nx>graphviz</span><span class=p>.</span><span class=nx>StyleFilled</span><span class=p>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>	<span class=nx>G</span><span class=p>.</span><span class=nf>DefaultNodeAttribute</span><span class=p>(</span><span class=nx>graphviz</span><span class=p>.</span><span class=nx>FillColor</span><span class=p>,</span> <span class=s>&#34;#B7BBBC&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>	<span class=c1>// G.MakeDirected()
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=nx>G</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=kd>func</span> <span class=nf>addSubTree</span><span class=p>(</span><span class=nx>root</span> <span class=o>*</span><span class=nx>node</span><span class=p>,</span> <span class=nx>G</span> <span class=o>*</span><span class=nx>graphviz</span><span class=p>.</span><span class=nx>Graph</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>	<span class=k>if</span> <span class=nx>root</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>		<span class=nx>null</span> <span class=o>:=</span> <span class=nx>G</span><span class=p>.</span><span class=nf>AddNode</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>		<span class=nx>G</span><span class=p>.</span><span class=nf>NodeAttribute</span><span class=p>(</span><span class=nx>null</span><span class=p>,</span> <span class=nx>graphviz</span><span class=p>.</span><span class=nx>Shape</span><span class=p>,</span> <span class=nx>graphviz</span><span class=p>.</span><span class=nx>ShapePoint</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>		<span class=k>return</span> <span class=nx>null</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>	<span class=nx>rootnode</span> <span class=o>:=</span> <span class=nx>G</span><span class=p>.</span><span class=nf>AddNode</span><span class=p>(</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprint</span><span class=p>(</span><span class=nx>root</span><span class=p>.</span><span class=nx>Key</span><span class=p>))</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>	<span class=k>if</span> <span class=nx>root</span><span class=p>.</span><span class=nf>isRed</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>		<span class=nx>G</span><span class=p>.</span><span class=nf>NodeAttribute</span><span class=p>(</span><span class=nx>rootnode</span><span class=p>,</span> <span class=nx>graphviz</span><span class=p>.</span><span class=nx>Style</span><span class=p>,</span> <span class=nx>graphviz</span><span class=p>.</span><span class=nx>StyleFilled</span><span class=p>)</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>		<span class=nx>G</span><span class=p>.</span><span class=nf>NodeAttribute</span><span class=p>(</span><span class=nx>rootnode</span><span class=p>,</span> <span class=nx>graphviz</span><span class=p>.</span><span class=nx>FillColor</span><span class=p>,</span> <span class=s>&#34;#F8BCC2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>	<span class=nx>leftnode</span> <span class=o>:=</span> <span class=nf>addSubTree</span><span class=p>(</span><span class=nx>root</span><span class=p>.</span><span class=nx>Left</span><span class=p>,</span> <span class=nx>G</span><span class=p>)</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>	<span class=nx>rightnode</span> <span class=o>:=</span> <span class=nf>addSubTree</span><span class=p>(</span><span class=nx>root</span><span class=p>.</span><span class=nx>Right</span><span class=p>,</span> <span class=nx>G</span><span class=p>)</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>	<span class=nx>G</span><span class=p>.</span><span class=nf>AddEdge</span><span class=p>(</span><span class=nx>rootnode</span><span class=p>,</span> <span class=nx>leftnode</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>	<span class=nx>G</span><span class=p>.</span><span class=nf>AddEdge</span><span class=p>(</span><span class=nx>rootnode</span><span class=p>,</span> <span class=nx>rightnode</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>	<span class=k>return</span> <span class=nx>rootnode</span>
</span></span><span class=line><span class=ln>34</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>调用生成<code>rbt.svg</code>：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://i.loli.net/2021/05/06/Pe5RWiYyrMhl1Gj.png data-srcset="https://i.loli.net/2021/05/06/Pe5RWiYyrMhl1Gj.png, https://i.loli.net/2021/05/06/Pe5RWiYyrMhl1Gj.png 1.5x, https://i.loli.net/2021/05/06/Pe5RWiYyrMhl1Gj.png 2x" data-sizes=auto alt=https://i.loli.net/2021/05/06/Pe5RWiYyrMhl1Gj.png title=rbt.png></p><h2 id=5-总结>5. 总结</h2><p>本文沿着红黑树同<code>2-3-4树</code>的关系脉络来讨论了红黑树里的插入及删除操作，其可能涉及的情况十分繁多，本文亦不能做到面面俱到。手绘的图也只展示了部分情况，力图通过简单的梳理来理解红黑树平衡性的本质。假如如果你此前对于<code>B树</code>已有很深入的理解的话，相信理解红黑树也不会花费太多时间。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-07-15&nbsp;<a class=git-hash href=https://github.com/phoon/phoon.github.io/commit/c8972b933e46d380901318bb9906f7d773df7afb target=_blank title="commit by PevenPhoon(iampeven@gmail.com) c8972b933e46d380901318bb9906f7d773df7afb: add analysis code">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>c8972b9</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://blog.peven.me/post/2021/05/08/the-red-black-tree/ data-title=红黑树那点事儿 data-hashtags=红黑树><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://blog.peven.me/post/2021/05/08/the-red-black-tree/ data-hashtag=红黑树><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://blog.peven.me/post/2021/05/08/the-red-black-tree/ data-title=红黑树那点事儿><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://blog.peven.me/post/2021/05/08/the-red-black-tree/ data-title=红黑树那点事儿><i data-svg-src=https://unpkg.com/simple-icons@7.0.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://blog.peven.me/post/2021/05/08/the-red-black-tree/ data-title=红黑树那点事儿><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/>红黑树</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/post/2019/08/15/anywhere2s-polling-issue-on-archlinux/ class=prev rel=prev title=解决Archlinux下蓝牙鼠标滞后感严重的问题><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>解决Archlinux下蓝牙鼠标滞后感严重的问题</a>
<a href=/post/2021/08/21/dgraph-memo/ class=next rel=next title=Dgraph备忘录>Dgraph备忘录<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.101.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2018 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://blog.peven.me target=_blank>Peven</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://unpkg.com/lightgallery@2.4.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://unpkg.com/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://unpkg.com/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://unpkg.com/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery@2.4.0/lightgallery.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery@2.4.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery@2.4.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://unpkg.com/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://unpkg.com/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:40},comment:{},lightgallery:!0,search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>